<!DOCTYPE html>
<html lang="pt">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Escola do Or√°culo | Leitor de Tarot com Cartas Reais</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      :root {
        --color-cream: #f5f5f0;
        --color-dark-purple: #4b0082;
        --color-gold: #c5a059;
        --color-text: #2c2c2c;
        --color-text-light: #6b6b6b;
        --color-white: #ffffff;
        --color-accent: #e8dcc8;
        --font-serif: "Georgia", "Playfair Display", serif;
        --font-sans: "Segoe UI", "Lato", sans-serif;
      }

      body {
        font-family: var(--font-sans);
        background: linear-gradient(to bottom, var(--color-cream), #fafaf8);
        color: var(--color-text);
        line-height: 1.6;
        padding: 2rem;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
      }

      h1 {
        font-family: var(--font-serif);
        text-align: center;
        color: var(--color-dark-purple);
        margin-bottom: 1rem;
        font-size: 2.5rem;
      }

      .subtitle {
        text-align: center;
        color: var(--color-text-light);
        margin-bottom: 2rem;
        font-size: 1.1rem;
      }

      /* ===== READING SELECTOR ===== */
      .reading-selector {
        display: flex;
        gap: 1rem;
        justify-content: center;
        flex-wrap: wrap;
        margin-bottom: 2rem;
      }

      .reading-btn {
        background: rgba(197, 160, 89, 0.1);
        border: 2px solid var(--color-gold);
        color: var(--color-text);
        padding: 0.75rem 1.5rem;
        border-radius: 25px;
        cursor: pointer;
        font-weight: 500;
        transition: all 0.3s;
        font-size: 0.95rem;
      }

      .reading-btn:hover {
        background: rgba(197, 160, 89, 0.2);
        transform: translateY(-2px);
      }

      .reading-btn.active {
        background: var(--color-gold);
        color: var(--color-text);
        font-weight: 600;
      }

      /* ===== CARD DISPLAY ===== */
      .card-container {
        background: var(--color-white);
        border-radius: 15px;
        padding: 2rem;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
        margin-bottom: 2rem;
      }

      .card-image {
        width: 100%;
        max-width: 300px;
        height: auto;
        margin: 0 auto 1.5rem;
        display: block;
        border-radius: 10px;
        box-shadow: 0 5px 15px rgba(75, 0, 130, 0.2);
        transition: transform 0.3s;
      }

      .card-image:hover {
        transform: scale(1.05);
      }

      .card-info {
        text-align: center;
        margin-bottom: 2rem;
      }

      .card-name {
        font-family: var(--font-serif);
        font-size: 2rem;
        color: var(--color-dark-purple);
        margin-bottom: 0.5rem;
        font-weight: bold;
      }

      .card-number {
        color: var(--color-gold);
        font-size: 1.1rem;
        font-weight: 600;
        margin-bottom: 0.5rem;
      }

      .card-element {
        color: var(--color-text-light);
        font-size: 0.95rem;
        margin-bottom: 1rem;
      }

      .card-orientation {
        display: inline-block;
        padding: 0.5rem 1rem;
        background: rgba(75, 0, 130, 0.1);
        border-radius: 20px;
        color: var(--color-dark-purple);
        font-weight: 600;
        margin-bottom: 1.5rem;
        font-size: 0.9rem;
      }

      /* ===== MEANINGS ===== */
      .meanings-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 1.5rem;
        margin: 2rem 0;
      }

      .meaning-box {
        background: rgba(75, 0, 130, 0.05);
        padding: 1.5rem;
        border-radius: 10px;
        border-left: 4px solid var(--color-gold);
      }

      .meaning-label {
        font-weight: 600;
        color: var(--color-dark-purple);
        text-transform: uppercase;
        font-size: 0.85rem;
        letter-spacing: 1px;
        margin-bottom: 0.75rem;
      }

      .meaning-text {
        color: var(--color-text);
        line-height: 1.6;
        font-size: 0.95rem;
      }

      .meaning-box.reversed {
        background: rgba(197, 160, 89, 0.05);
        border-left-color: var(--color-gold);
      }

      /* ===== SPREAD DISPLAY ===== */
      .spread-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 2rem;
        margin-top: 2rem;
      }

      .spread-card {
        background: var(--color-white);
        border: 2px solid var(--color-gold);
        border-radius: 12px;
        padding: 1.5rem;
        text-align: center;
        transition: all 0.3s;
      }

      .spread-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 25px rgba(75, 0, 130, 0.15);
      }

      .spread-position {
        font-weight: 600;
        color: var(--color-dark-purple);
        margin-bottom: 1rem;
        font-size: 1.1rem;
      }

      .spread-position-meaning {
        font-size: 0.9rem;
        color: var(--color-text-light);
        margin-bottom: 1rem;
        font-style: italic;
      }

      .spread-card-image {
        width: 100%;
        height: 200px;
        object-fit: cover;
        border-radius: 8px;
        margin: 1rem 0;
      }

      .spread-card-name {
        font-family: var(--font-serif);
        font-size: 1.3rem;
        color: var(--color-dark-purple);
        margin: 1rem 0 0.5rem;
        font-weight: bold;
      }

      .spread-orientation {
        font-size: 0.8rem;
        color: var(--color-gold);
        font-weight: 600;
      }

      /* ===== BUTTONS ===== */
      .btn {
        background: var(--color-dark-purple);
        color: var(--color-white);
        padding: 1rem 2rem;
        border: none;
        border-radius: 50px;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
        display: inline-block;
        margin: 0.5rem;
      }

      .btn:hover {
        background: var(--color-gold);
        color: var(--color-text);
        transform: translateY(-2px);
        box-shadow: 0 10px 25px rgba(75, 0, 130, 0.2);
      }

      .btn-primary {
        width: 100%;
        margin: 1rem 0;
      }

      /* ===== CELTIC CROSS ===== */
      .celtic-grid {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 1.5rem;
        margin-top: 2rem;
      }

      .celtic-card {
        background: linear-gradient(
          135deg,
          rgba(75, 0, 130, 0.05),
          rgba(197, 160, 89, 0.05)
        );
        border: 2px solid var(--color-gold);
        border-radius: 12px;
        padding: 1rem;
        text-align: center;
      }

      .celtic-position-num {
        background: var(--color-gold);
        color: var(--color-text);
        width: 35px;
        height: 35px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        margin: 0 auto 0.5rem;
        font-size: 0.9rem;
      }

      .celtic-position-title {
        font-weight: 600;
        color: var(--color-dark-purple);
        font-size: 0.95rem;
        margin-bottom: 0.5rem;
      }

      .celtic-card-image {
        width: 100%;
        height: 150px;
        object-fit: cover;
        border-radius: 8px;
        margin: 0.75rem 0;
      }

      .celtic-card-name {
        font-size: 0.9rem;
        color: var(--color-text);
        font-weight: 600;
        margin-bottom: 0.3rem;
      }

      .celtic-meaning {
        font-size: 0.8rem;
        color: var(--color-text-light);
        font-style: italic;
      }

      /* ===== RESPONSIVE ===== */
      @media (max-width: 768px) {
        h1 {
          font-size: 1.8rem;
        }

        .card-name {
          font-size: 1.5rem;
        }

        .spread-grid {
          grid-template-columns: 1fr;
        }

        .celtic-grid {
          grid-template-columns: repeat(2, 1fr);
          gap: 1rem;
        }

        .card-container {
          padding: 1.5rem;
        }
      }

      .hidden {
        display: none !important;
      }

      .history-list {
        display: grid;
        gap: 0.75rem;
        margin-top: 1rem;
      }

      .history-item {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 1rem;
        padding: 0.9rem 1rem;
        border-radius: 12px;
        border: 1px solid rgba(75, 0, 130, 0.12);
        background: linear-gradient(
          135deg,
          rgba(75, 0, 130, 0.03),
          rgba(197, 160, 89, 0.04)
        );
      }

      .history-meta {
        display: grid;
        gap: 0.15rem;
      }

      .history-title {
        font-weight: 700;
        color: var(--color-dark-purple);
      }

      .history-subtitle {
        font-size: 0.9rem;
        color: var(--color-text-light);
      }

      .history-actions {
        display: flex;
        gap: 0.5rem;
        flex-wrap: wrap;
        justify-content: flex-end;
      }

      .btn-secondary {
        background: rgba(75, 0, 130, 0.08);
        color: var(--color-dark-purple);
      }

      .btn-secondary:hover {
        background: rgba(75, 0, 130, 0.12);
        color: var(--color-dark-purple);
      }
    </style>
  </head>
  <body>
    <div class="container">
      <!-- Back Navigation -->
      <div style="margin-bottom: 1.5rem">
        <a
          href="index.html"
          style="
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1.5rem;
            background: rgba(197, 160, 89, 0.1);
            color: var(--color-dark-purple);
            border: 2px solid var(--color-gold);
            border-radius: 50px;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s;
          "
          onmouseover="this.style.background='var(--color-gold)'; this.style.color='var(--color-text)';"
          onmouseout="this.style.background='rgba(197, 160, 89, 0.1)'; this.style.color='var(--color-dark-purple)';"
        >
          ‚Üê Voltar ao Site Principal
        </a>
      </div>

      <h1>‚ú® Leitor de Tarot ‚ú®</h1>
      <p class="subtitle">
        Escola do Or√°culo por Rafaella Kally | Cartas Reais do Tarot Rider-Waite
      </p>

      <!-- Reading Type Selector -->
      <div class="reading-selector">
        <button
          class="reading-btn active"
          data-reading="daily"
          onclick="switchReading('daily', this)"
        >
          üìç Mensagem do Dia
        </button>
        <button
          class="reading-btn"
          data-reading="three"
          onclick="switchReading('three', this)"
        >
          ‚åõ Passado, Presente, Futuro
        </button>
        <button
          class="reading-btn"
          data-reading="celtic"
          onclick="switchReading('celtic', this)"
        >
          ‚úö Cruz Celta (10 Cartas)
        </button>
        <button
          class="reading-btn"
          data-reading="love"
          onclick="switchReading('love', this)"
        >
          üíï Relacionamento (3 Cartas)
        </button>
        <button
          class="reading-btn"
          data-reading="five"
          onclick="switchReading('five', this)"
        >
          ‚≠ê Leitura 5 Cartas
        </button>
        <button
          class="reading-btn"
          data-reading="horseshoe"
          onclick="switchReading('horseshoe', this)"
        >
          üß≤ Ferradura (7 Cartas)
        </button>
      </div>

      <!-- Daily Reading -->
      <div id="daily-section" class="card-container">
        <h2
          style="
            text-align: center;
            color: var(--color-dark-purple);
            margin-bottom: 1.5rem;
          "
        >
          Sua Carta do Dia
        </h2>
        <div id="daily-content"></div>
        <button class="btn btn-primary" onclick="drawDailyCard()">
          Tirar Carta do Dia
        </button>
      </div>

      <!-- Three Card Reading -->
      <div id="three-section" class="hidden">
        <h2
          style="
            text-align: center;
            color: var(--color-dark-purple);
            margin-bottom: 1.5rem;
          "
        >
          Leitura de Tr√™s Cartas
        </h2>
        <div class="spread-grid" id="three-content"></div>
        <button class="btn btn-primary" onclick="drawThreeCards()">
          Fazer Leitura
        </button>
      </div>

      <!-- Celtic Cross -->
      <div id="celtic-section" class="hidden">
        <h2
          style="
            text-align: center;
            color: var(--color-dark-purple);
            margin-bottom: 1.5rem;
          "
        >
          Cruz Celta: 10 Posi√ß√µes
        </h2>
        <div class="celtic-grid" id="celtic-content"></div>
        <button class="btn btn-primary" onclick="drawCelticCross()">
          Fazer Cruz Celta
        </button>
      </div>

      <!-- Love Reading -->
      <div id="love-section" class="hidden">
        <h2
          style="
            text-align: center;
            color: var(--color-dark-purple);
            margin-bottom: 1.5rem;
          "
        >
          Leitura de Relacionamento
        </h2>
        <div class="spread-grid" id="love-content"></div>
        <button class="btn btn-primary" onclick="drawLoveReading()">
          Fazer Leitura de Amor
        </button>
      </div>

      <!-- Five Card Reading -->
      <div id="five-section" class="hidden">
        <h2
          style="
            text-align: center;
            color: var(--color-dark-purple);
            margin-bottom: 1.5rem;
          "
        >
          Leitura de 5 Cartas
        </h2>
        <div class="spread-grid" id="five-content"></div>
        <button class="btn btn-primary" onclick="drawFiveCardReading()">
          Fazer Leitura
        </button>
      </div>

      <!-- Horseshoe Reading -->
      <div id="horseshoe-section" class="hidden">
        <h2
          style="
            text-align: center;
            color: var(--color-dark-purple);
            margin-bottom: 1.5rem;
          "
        >
          Leitura da Ferradura (7 Cartas)
        </h2>
        <div class="spread-grid" id="horseshoe-content"></div>
        <button class="btn btn-primary" onclick="drawHorseshoeReading()">
          Fazer Leitura
        </button>
      </div>

      <!-- Reading History -->
      <div id="history-section" class="card-container">
        <h2
          style="
            text-align: center;
            color: var(--color-dark-purple);
            margin-bottom: 0.5rem;
          "
        >
          Hist√≥rico
        </h2>
        <p style="text-align: center; color: var(--color-text-light)">
          Leituras guardadas neste navegador
        </p>
        <div id="history-content" class="history-list"></div>
        <div style="display: flex; justify-content: center; margin-top: 1rem">
          <button class="btn btn-secondary" onclick="clearHistory()">
            Limpar Hist√≥rico
          </button>
        </div>
      </div>
    </div>

    <script>
      // Uses Rider‚ÄìWaite‚ÄìSmith imagery hosted on Wikimedia Commons.
      // For commercial use, confirm the license for your jurisdiction.

      const HISTORY_KEY = "oracle.tarot.history.v1";
      const DEFAULT_IMAGE_WIDTH = 360;

      function rwsImageUrl(fileName, width = DEFAULT_IMAGE_WIDTH) {
        // Avoid hard-coded Wikimedia hash paths by using Special:FilePath.
        return `https://commons.wikimedia.org/wiki/Special:FilePath/${encodeURIComponent(
          fileName
        )}?width=${width}`;
      }

      function pad2(n) {
        return String(n).padStart(2, "0");
      }

      function mulberry32(seed) {
        let a = seed >>> 0;
        return function () {
          a += 0x6d2b79f5;
          let t = Math.imul(a ^ (a >>> 15), 1 | a);
          t ^= t + Math.imul(t ^ (t >>> 7), 61 | t);
          return ((t ^ (t >>> 14)) >>> 0) / 4294967296;
        };
      }

      function seedFromString(str) {
        let h = 2166136261;
        for (let i = 0; i < str.length; i++) {
          h ^= str.charCodeAt(i);
          h = Math.imul(h, 16777619);
        }
        return h >>> 0;
      }

      function shuffle(array, randomFn) {
        for (let i = array.length - 1; i > 0; i--) {
          const j = Math.floor(randomFn() * (i + 1));
          [array[i], array[j]] = [array[j], array[i]];
        }
      }

      const MAJOR_ARCANA = [
        {
          id: "major-00",
          number: "0",
          name: "O Louco",
          element: "Ar",
          file: "RWS_Tarot_00_Fool.jpg",
          meanings: {
            upright: "Novos come√ßos, inoc√™ncia, espontaneidade, aventura",
            reversed: "Impulsividade, descuido, precipita√ß√£o",
          },
          interpretation:
            "Um novo ciclo pede coragem e abertura. Confie no caminho, mas mantenha o bom senso.",
          keywords: ["Come√ßo", "Liberdade", "Risco", "Potencial"],
        },
        {
          id: "major-01",
          number: "I",
          name: "O Mago",
          element: "Merc√∫rio",
          file: "RWS_Tarot_01_Magician.jpg",
          meanings: {
            upright: "Poder pessoal, recursos, a√ß√£o, manifesta√ß√£o",
            reversed: "Manipula√ß√£o, inseguran√ßa, energia dispersa",
          },
          interpretation:
            "Voc√™ tem os recursos necess√°rios. Direcione sua vontade e aja com foco.",
          keywords: ["A√ß√£o", "Foco", "Manifesta√ß√£o", "Talento"],
        },
        {
          id: "major-02",
          number: "II",
          name: "A Sacerdotisa",
          element: "Lua",
          file: "RWS_Tarot_02_Priestess.jpg",
          meanings: {
            upright: "Intui√ß√£o, mist√©rio, sil√™ncio, sabedoria interior",
            reversed: "D√∫vida, superficialidade, ignorar sinais",
          },
          interpretation:
            "Respostas v√™m de dentro. Observe sinais e n√£o force conclus√µes.",
          keywords: ["Intui√ß√£o", "Mist√©rio", "Sil√™ncio", "Percep√ß√£o"],
        },
        {
          id: "major-03",
          number: "III",
          name: "A Imperatriz",
          element: "V√©nus",
          file: "RWS_Tarot_03_Empress.jpg",
          meanings: {
            upright: "Abund√¢ncia, criatividade, cuidado, fertilidade",
            reversed: "Excesso, neglig√™ncia, bloqueio criativo",
          },
          interpretation:
            "Nutra o que quer ver crescer. Cria√ß√£o e prazer caminham juntos.",
          keywords: ["Abund√¢ncia", "Cria√ß√£o", "Cuidado", "Crescimento"],
        },
        {
          id: "major-04",
          number: "IV",
          name: "O Imperador",
          element: "√Åries",
          file: "RWS_Tarot_04_Emperor.jpg",
          meanings: {
            upright: "Estrutura, autoridade, limites, lideran√ßa",
            reversed: "Rigidez, controle excessivo, instabilidade",
          },
          interpretation:
            "Organize, planeje e estabele√ßa limites claros. A firmeza d√° seguran√ßa.",
          keywords: ["Estrutura", "Lideran√ßa", "Ordem", "Limites"],
        },
        {
          id: "major-05",
          number: "V",
          name: "O Papa",
          element: "Touro",
          file: "RWS_Tarot_05_Hierophant.jpg",
          meanings: {
            upright: "Tradi√ß√£o, ensino, √©tica, mentoria",
            reversed: "Dogma, rebeldia sem prop√≥sito, conflito de valores",
          },
          interpretation:
            "Procure orienta√ß√£o confi√°vel. Aprendizado estruturado trar√° clareza.",
          keywords: ["Mentoria", "Tradi√ß√£o", "Valores", "Aprender"],
        },
        {
          id: "major-06",
          number: "VI",
          name: "Os Apaixonados",
          element: "G√©meos",
          file: "RWS_Tarot_06_Lovers.jpg",
          meanings: {
            upright: "Amor, uni√£o, escolhas alinhadas a valores",
            reversed: "Desalinhamento, indecis√£o, tenta√ß√£o",
          },
          interpretation:
            "Escolhas importam. Decida pelo que est√° alinhado aos seus valores.",
          keywords: ["Escolha", "Amor", "Valores", "Uni√£o"],
        },
        {
          id: "major-07",
          number: "VII",
          name: "O Carro",
          element: "Caranguejo",
          file: "RWS_Tarot_07_Chariot.jpg",
          meanings: {
            upright: "Determina√ß√£o, avan√ßo, vit√≥ria, dire√ß√£o",
            reversed: "Falta de dire√ß√£o, pressa, conflito interno",
          },
          interpretation:
            "Avance com disciplina. Dire√ß√£o clara vence resist√™ncias.",
          keywords: ["Vit√≥ria", "Dire√ß√£o", "Controle", "Avan√ßo"],
        },
        {
          id: "major-08",
          number: "VIII",
          name: "A For√ßa",
          element: "Le√£o",
          file: "RWS_Tarot_08_Strength.jpg",
          meanings: {
            upright: "Coragem, autocontrole, gentileza, resili√™ncia",
            reversed: "Inseguran√ßa, reatividade, fraqueza",
          },
          interpretation:
            "A for√ßa verdadeira √© calma. Confie em voc√™ e v√° com consist√™ncia.",
          keywords: ["Coragem", "Resili√™ncia", "Calma", "Confian√ßa"],
        },
        {
          id: "major-09",
          number: "IX",
          name: "O Eremita",
          element: "Virgem",
          file: "RWS_Tarot_09_Hermit.jpg",
          meanings: {
            upright: "Introspec√ß√£o, sabedoria, recolhimento, busca",
            reversed: "Isolamento excessivo, medo, evas√£o",
          },
          interpretation: "D√™ um passo atr√°s. O sil√™ncio traz entendimento.",
          keywords: ["Busca", "Sabedoria", "Pausa", "Reflex√£o"],
        },
        {
          id: "major-10",
          number: "X",
          name: "A Roda da Fortuna",
          element: "J√∫piter",
          file: "RWS_Tarot_10_Wheel_of_Fortune.jpg",
          meanings: {
            upright: "Ciclos, virada, destino, oportunidade",
            reversed: "Resist√™ncia √† mudan√ßa, repeti√ß√£o de padr√£o",
          },
          interpretation:
            "Mudan√ßas chegam. Aproveite a oportunidade e adapte-se.",
          keywords: ["Ciclos", "Mudan√ßa", "Sorte", "Virada"],
        },
        {
          id: "major-11",
          number: "XI",
          name: "A Justi√ßa",
          element: "Libra",
          file: "RWS_Tarot_11_Justice.jpg",
          meanings: {
            upright: "Verdade, equil√≠brio, responsabilidade",
            reversed: "Injusti√ßa, parcialidade, consequ√™ncias",
          },
          interpretation:
            "Aja com honestidade. O que foi semeado ser√° colhido.",
          keywords: ["Verdade", "Equil√≠brio", "Lei", "Responsabilidade"],
        },
        {
          id: "major-12",
          number: "XII",
          name: "O Enforcado",
          element: "Neptuno",
          file: "RWS_Tarot_12_Hanged_Man.jpg",
          meanings: {
            upright: "Pausa, nova perspectiva, rendi√ß√£o",
            reversed: "Teimosia, estagna√ß√£o, apego",
          },
          interpretation:
            "Veja por outro √¢ngulo. Um recuo pode ser estrat√©gico.",
          keywords: ["Perspectiva", "Pausa", "Rendi√ß√£o", "Revis√£o"],
        },
        {
          id: "major-13",
          number: "XIII",
          name: "A Morte",
          element: "Escorpi√£o",
          file: "RWS_Tarot_13_Death.jpg",
          meanings: {
            upright: "Fim, transi√ß√£o, transforma√ß√£o",
            reversed: "Resist√™ncia, medo, atraso",
          },
          interpretation:
            "Um ciclo encerra para outro come√ßar. Solte o que j√° passou.",
          keywords: ["Transforma√ß√£o", "Fim", "Renova√ß√£o", "Transi√ß√£o"],
        },
        {
          id: "major-14",
          number: "XIV",
          name: "A Temperan√ßa",
          element: "Sagit√°rio",
          file: "RWS_Tarot_14_Temperance.jpg",
          meanings: {
            upright: "Modera√ß√£o, harmonia, equil√≠brio",
            reversed: "Excesso, descompasso, impaci√™ncia",
          },
          interpretation:
            "Ajuste o ritmo. A mistura certa traz cura e fluidez.",
          keywords: ["Equil√≠brio", "Cura", "Modera√ß√£o", "Harmonia"],
        },
        {
          id: "major-15",
          number: "XV",
          name: "O Diabo",
          element: "Capric√≥rnio",
          file: "RWS_Tarot_15_Devil.jpg",
          meanings: {
            upright: "Apego, excessos, depend√™ncias, sombras",
            reversed: "Liberta√ß√£o, consci√™ncia, limites",
          },
          interpretation:
            "Observe o que prende voc√™. A liberdade come√ßa com consci√™ncia.",
          keywords: ["Apego", "Sombras", "Limites", "Liberta√ß√£o"],
        },
        {
          id: "major-16",
          number: "XVI",
          name: "A Torre",
          element: "Marte",
          file: "RWS_Tarot_16_Tower.jpg",
          meanings: {
            upright: "Ruptura, revela√ß√£o, queda de ilus√µes",
            reversed: "Mudan√ßa evitada, crise prolongada",
          },
          interpretation:
            "O que era fr√°gil cai. Verdades emergem para recome√ßar melhor.",
          keywords: ["Ruptura", "Verdade", "Revela√ß√£o", "Recome√ßo"],
        },
        {
          id: "major-17",
          number: "XVII",
          name: "A Estrela",
          element: "Aqu√°rio",
          file: "RWS_Tarot_17_Star.jpg",
          meanings: {
            upright: "Esperan√ßa, inspira√ß√£o, cura",
            reversed: "Des√¢nimo, falta de f√©",
          },
          interpretation:
            "Confie na recupera√ß√£o. H√° luz e dire√ß√£o para seguir.",
          keywords: ["Esperan√ßa", "Cura", "Inspira√ß√£o", "F√©"],
        },
        {
          id: "major-18",
          number: "XVIII",
          name: "A Lua",
          element: "Peixes",
          file: "RWS_Tarot_18_Moon.jpg",
          meanings: {
            upright: "Inconsciente, intui√ß√£o, confus√£o, ilus√µes",
            reversed: "Clareza, verdade emergindo",
          },
          interpretation:
            "Nem tudo est√° claro. Caminhe devagar e confie nos sinais.",
          keywords: ["Intui√ß√£o", "Sonhos", "Sombras", "Mist√©rio"],
        },
        {
          id: "major-19",
          number: "XIX",
          name: "O Sol",
          element: "Sol",
          file: "RWS_Tarot_19_Sun.jpg",
          meanings: {
            upright: "Alegria, sucesso, clareza, vitalidade",
            reversed: "Atrasos, inseguran√ßa, falta de brilho",
          },
          interpretation: "Clareza e alegria. Mostre-se e siga com confian√ßa.",
          keywords: ["Sucesso", "Alegria", "Clareza", "Vitalidade"],
        },
        {
          id: "major-20",
          number: "XX",
          name: "O Julgamento",
          element: "Plut√£o",
          file: "RWS_Tarot_20_Judgement.jpg",
          meanings: {
            upright: "Despertar, chamado, avalia√ß√£o, renascimento",
            reversed: "Autojulgamento, adiamento, d√∫vida",
          },
          interpretation:
            "Um chamado pede decis√£o. Assuma a responsabilidade e renas√ßa.",
          keywords: ["Chamado", "Renascimento", "Decis√£o", "Consci√™ncia"],
        },
        {
          id: "major-21",
          number: "XXI",
          name: "O Mundo",
          element: "Saturno",
          file: "RWS_Tarot_21_World.jpg",
          meanings: {
            upright: "Conclus√£o, realiza√ß√£o, ciclo completo",
            reversed: "Pend√™ncias, atraso, sensa√ß√£o de incompletude",
          },
          interpretation:
            "Fechamento positivo. Celebre e prepare o pr√≥ximo ciclo.",
          keywords: ["Conclus√£o", "Realiza√ß√£o", "Ciclo", "Integra√ß√£o"],
        },
      ];

      const SUITS = [
        { key: "wands", pt: "Paus", en: "Wands", element: "Fogo", base: 22 },
        { key: "cups", pt: "Copas", en: "Cups", element: "√Ågua", base: 36 },
        { key: "swords", pt: "Espadas", en: "Swords", element: "Ar", base: 50 },
        {
          key: "pentacles",
          pt: "Ouros",
          en: "Pentacles",
          element: "Terra",
          base: 64,
        },
      ];

      const RANKS = [
        { key: "ace", pt: "√Ås", en: "Ace", value: 1 },
        { key: "two", pt: "Dois", en: "Two", value: 2 },
        { key: "three", pt: "Tr√™s", en: "Three", value: 3 },
        { key: "four", pt: "Quatro", en: "Four", value: 4 },
        { key: "five", pt: "Cinco", en: "Five", value: 5 },
        { key: "six", pt: "Seis", en: "Six", value: 6 },
        { key: "seven", pt: "Sete", en: "Seven", value: 7 },
        { key: "eight", pt: "Oito", en: "Eight", value: 8 },
        { key: "nine", pt: "Nove", en: "Nine", value: 9 },
        { key: "ten", pt: "Dez", en: "Ten", value: 10 },
        { key: "page", pt: "Pajem", en: "Page" },
        { key: "knight", pt: "Cavaleiro", en: "Knight" },
        { key: "queen", pt: "Rainha", en: "Queen" },
        { key: "king", pt: "Rei", en: "King" },
      ];

      // Compact, suit-specific meanings (upright + reversed) for Minor Arcana.
      // These are short descriptors to keep UX clean.
      const MINOR_MEANINGS = {
        wands: [
          {
            u: "In√≠cio criativo, impulso, coragem",
            r: "Bloqueio, falta de energia, atraso",
            k: ["Come√ßo", "Criatividade", "A√ß√£o"],
          },
          {
            u: "Planejamento, escolhas, expans√£o",
            r: "Medo de avan√ßar, indecis√£o",
            k: ["Plano", "Escolha", "Vis√£o"],
          },
          {
            u: "Crescimento, progresso, horizonte",
            r: "Atrasos, frustra√ß√£o, falta de dire√ß√£o",
            k: ["Expans√£o", "Progresso", "Horizonte"],
          },
          {
            u: "Celebra√ß√£o, harmonia, conquista",
            r: "Tens√£o no lar, instabilidade",
            k: ["Festa", "Lar", "Uni√£o"],
          },
          {
            u: "Competi√ß√£o, desafios, atrito",
            r: "Evitar conflito, desuni√£o",
            k: ["Desafio", "Disputa", "Energia"],
          },
          {
            u: "Vit√≥ria, reconhecimento, confian√ßa",
            r: "Ego ferido, falta de apoio",
            k: ["Vit√≥ria", "Reconhecimento", "Orgulho"],
          },
          {
            u: "Defesa, coragem, posi√ß√£o firme",
            r: "Cansa√ßo, desist√™ncia, vulnerabilidade",
            k: ["Defesa", "Coragem", "Limites"],
          },
          {
            u: "Rapidez, not√≠cias, movimento",
            r: "Imprevistos, atraso, confus√£o",
            k: ["Movimento", "Not√≠cias", "Velocidade"],
          },
          {
            u: "Persist√™ncia, resist√™ncia, foco",
            r: "Exaust√£o, paranoia, falta de energia",
            k: ["Persistir", "Resistir", "Foco"],
          },
          {
            u: "Sobrecarga, responsabilidade, press√£o",
            r: "Al√≠vio, delegar, reorganizar",
            k: ["Carga", "Dever", "Limites"],
          },
          {
            u: "Curiosidade, entusiasmo, in√≠cio de jornada",
            r: "Imaturidade, pressa, falta de dire√ß√£o",
            k: ["Entusiasmo", "Explorar", "Come√ßar"],
          },
          {
            u: "A√ß√£o r√°pida, coragem, aventura",
            r: "Impulsividade, instabilidade",
            k: ["A√ß√£o", "Coragem", "Impulso"],
          },
          {
            u: "Confian√ßa, magnetismo, criatividade",
            r: "Inseguran√ßa, ci√∫mes, des√¢nimo",
            k: ["Confian√ßa", "Cria√ß√£o", "Carisma"],
          },
          {
            u: "Lideran√ßa, vis√£o, empreendedorismo",
            r: "Autoritarismo, impaci√™ncia, rigidez",
            k: ["Liderar", "Vis√£o", "Criar"],
          },
        ],
        cups: [
          {
            u: "Novo sentimento, abertura do cora√ß√£o",
            r: "Bloqueio emocional, vazio",
            k: ["Amor", "Abertura", "Emo√ß√£o"],
          },
          {
            u: "Parceria, uni√£o, reciprocidade",
            r: "Ruptura, desalinho, tens√£o",
            k: ["Uni√£o", "Acordo", "Reciprocidade"],
          },
          {
            u: "Amizade, celebra√ß√£o, comunidade",
            r: "Excessos, fofoca, isolamento",
            k: ["Festa", "Amigos", "Comunidade"],
          },
          {
            u: "Apatia, contempla√ß√£o, reavaliar",
            r: "Novas chances, aceita√ß√£o",
            k: ["Reavaliar", "Pausa", "Convite"],
          },
          {
            u: "Perda, tristeza, luto",
            r: "Recupera√ß√£o, esperan√ßa, perd√£o",
            k: ["Luto", "Perda", "Cura"],
          },
          {
            u: "Nostalgia, ternura, passado",
            r: "Preso ao passado, idealiza√ß√£o",
            k: ["Mem√≥ria", "Do√ßura", "Inf√¢ncia"],
          },
          {
            u: "Fantasias, escolhas, ilus√µes",
            r: "Clareza, decis√£o, foco",
            k: ["Escolhas", "Ilus√£o", "Imaginar"],
          },
          {
            u: "Partida, busca, desapego",
            r: "Medo de sair, voltar atr√°s",
            k: ["Busca", "Desapego", "Transi√ß√£o"],
          },
          {
            u: "Satisfa√ß√£o, desejo realizado",
            r: "Excesso, vazio ap√≥s conquista",
            k: ["Satisfa√ß√£o", "Desejo", "Prazer"],
          },
          {
            u: "Harmonia, fam√≠lia, plenitude",
            r: "Conflitos no lar, desalinho",
            k: ["Fam√≠lia", "Harmonia", "Amor"],
          },
          {
            u: "Sensibilidade, mensagens, romance",
            r: "Imaturidade emocional, ilus√£o",
            k: ["Romance", "Mensagem", "Sens√≠vel"],
          },
          {
            u: "Charme, proposta, movimento afetivo",
            r: "Volatilidade, promessas vazias",
            k: ["Convite", "Charme", "Afeto"],
          },
          {
            u: "Empatia, intui√ß√£o, acolhimento",
            r: "Codepend√™ncia, instabilidade",
            k: ["Empatia", "Intui√ß√£o", "Cuidar"],
          },
          {
            u: "Maturidade emocional, equil√≠brio",
            r: "Frieza, repress√£o, oscila√ß√£o",
            k: ["Maturidade", "Equil√≠brio", "Cora√ß√£o"],
          },
        ],
        swords: [
          {
            u: "Clareza, verdade, decis√£o",
            r: "Confus√£o, mentiras, falta de foco",
            k: ["Verdade", "Corte", "Clareza"],
          },
          {
            u: "Impasse, indecis√£o, bloqueio",
            r: "Escolha feita, desbloqueio",
            k: ["Impasse", "Escolha", "Sil√™ncio"],
          },
          {
            u: "Dor, separa√ß√£o, cora√ß√£o partido",
            r: "Cura, supera√ß√£o, perd√£o",
            k: ["Dor", "Cura", "Verdade"],
          },
          {
            u: "Descanso, pausa, recupera√ß√£o",
            r: "Agita√ß√£o, ansiedade, exaust√£o",
            k: ["Pausa", "Recuperar", "Sil√™ncio"],
          },
          {
            u: "Conflito, vit√≥ria amarga",
            r: "Reconcilia√ß√£o, ceder, aprender",
            k: ["Conflito", "Ego", "Consequ√™ncia"],
          },
          {
            u: "Transi√ß√£o, travessia, al√≠vio",
            r: "Resist√™ncia, bagagem emocional",
            k: ["Transi√ß√£o", "Mudan√ßa", "Al√≠vio"],
          },
          {
            u: "Estrat√©gia, discri√ß√£o, segredo",
            r: "Exposi√ß√£o, culpa, verdade",
            k: ["Estrat√©gia", "Segredo", "Cautela"],
          },
          {
            u: "Restri√ß√£o, medo, auto-sabotagem",
            r: "Liberta√ß√£o, clareza, coragem",
            k: ["Medo", "Limite", "Libertar"],
          },
          {
            u: "Ansiedade, preocupa√ß√£o, pesadelos",
            r: "Melhora, apoio, descanso",
            k: ["Ansiedade", "Medo", "Dormir"],
          },
          {
            u: "Fim, colapso, esgotamento",
            r: "Recupera√ß√£o, recome√ßo, al√≠vio",
            k: ["Fim", "Recome√ßo", "Esgoto"],
          },
          {
            u: "Curiosidade, mente ativa, verdade",
            r: "Fofoca, imaturidade, impulsos",
            k: ["Curioso", "Verdade", "Agilidade"],
          },
          {
            u: "A√ß√£o direta, impulso mental",
            r: "Agressividade, precipita√ß√£o",
            k: ["A√ß√£o", "Direto", "Coragem"],
          },
          {
            u: "Clareza, independ√™ncia, honestidade",
            r: "Dureza, amargura, cr√≠tica",
            k: ["Clareza", "Independente", "Honesto"],
          },
          {
            u: "Autoridade, l√≥gica, justi√ßa",
            r: "Tirania, frieza, abuso",
            k: ["L√≥gica", "Autoridade", "Justi√ßa"],
          },
        ],
        pentacles: [
          {
            u: "Oportunidade material, prosperidade",
            r: "Perda, m√° gest√£o, atraso",
            k: ["Oportunidade", "Dinheiro", "Come√ßo"],
          },
          {
            u: "Equil√≠brio, adapta√ß√£o, m√∫ltiplas tarefas",
            r: "Desequil√≠brio, sobrecarga",
            k: ["Equil√≠brio", "Rotina", "Ajuste"],
          },
          {
            u: "Trabalho em equipe, mestria",
            r: "Falta de colabora√ß√£o, amadorismo",
            k: ["Equipe", "Mestria", "Construir"],
          },
          {
            u: "Seguran√ßa, conservar, poupar",
            r: "Apego, medo de perder",
            k: ["Seguran√ßa", "Poupar", "Apego"],
          },
          {
            u: "Dificuldade, escassez, preocupa√ß√£o",
            r: "Recupera√ß√£o, ajuda, esperan√ßa",
            k: ["Escassez", "Apoio", "Recuperar"],
          },
          {
            u: "Generosidade, troca, equil√≠brio",
            r: "D√≠vida, depend√™ncia, injusti√ßa",
            k: ["Dar", "Receber", "Equidade"],
          },
          {
            u: "Paci√™ncia, investimento, colheita",
            r: "Impaci√™ncia, atraso, frustra√ß√£o",
            k: ["Paci√™ncia", "Investir", "Colher"],
          },
          {
            u: "Aprendizado, disciplina, trabalho",
            r: "Falta de foco, desleixo",
            k: ["Trabalho", "Disciplina", "Aprender"],
          },
          {
            u: "Independ√™ncia, conforto, bem-estar",
            r: "Excesso, isolamento, depend√™ncia",
            k: ["Conforto", "Independente", "Valor"],
          },
          {
            u: "Legado, fam√≠lia, estabilidade",
            r: "Conflitos familiares, instabilidade",
            k: ["Legado", "Fam√≠lia", "Est√°vel"],
          },
          {
            u: "Estudo, oportunidade, pr√°tica",
            r: "Procrastina√ß√£o, falta de compromisso",
            k: ["Estudar", "Pr√°tica", "Potencial"],
          },
          {
            u: "Const√¢ncia, responsabilidade, ritmo",
            r: "Lentid√£o, teimosia, estagna√ß√£o",
            k: ["Const√¢ncia", "Ritmo", "Dever"],
          },
          {
            u: "Praticidade, cuidado, abund√¢ncia",
            r: "Inseguran√ßa, desequil√≠brio",
            k: ["Pr√°tico", "Cuidar", "Abund√¢ncia"],
          },
          {
            u: "Realiza√ß√£o, lideran√ßa, recursos",
            r: "Gan√¢ncia, rigidez, teimosia",
            k: ["Liderar", "Recursos", "Realizar"],
          },
        ],
      };

      function buildMinorArcana() {
        const cards = [];
        for (const suit of SUITS) {
          for (let i = 0; i < RANKS.length; i++) {
            const rank = RANKS[i];
            const num = suit.base + i;
            const file = `RWS_Tarot_${pad2(num)}_${rank.en}_of_${suit.en}.jpg`;
            const name = `${rank.pt} de ${suit.pt}`;
            const m = MINOR_MEANINGS[suit.key][i];
            cards.push({
              id: `minor-${suit.key}-${rank.key}`,
              arcana: "minor",
              suitKey: suit.key,
              suitPt: suit.pt,
              element: suit.element,
              rankKey: rank.key,
              rankValue: rank.value ?? null,
              number: String(num),
              name,
              file,
              meanings: { upright: m.u, reversed: m.r },
              interpretation:
                "Considere o contexto da pergunta e a posi√ß√£o no jogo para aprofundar o significado.",
              keywords: m.k,
            });
          }
        }
        return cards;
      }

      const DECK = [
        ...MAJOR_ARCANA.map((c) => ({
          ...c,
          arcana: "major",
          image: rwsImageUrl(c.file),
        })),
        ...buildMinorArcana().map((c) => ({
          ...c,
          image: rwsImageUrl(c.file),
        })),
      ];

      const CARD_BY_ID = new Map(DECK.map((c) => [c.id, c]));

      const spreads = {
        three: [
          { position: "Passado", meaning: "O que o trouxe at√© aqui" },
          { position: "Presente", meaning: "Sua situa√ß√£o atual" },
          { position: "Futuro", meaning: "Para onde voc√™ vai" },
        ],
        celtic: [
          { num: 1, position: "Significa√ß√£o", meaning: "O n√∫cleo da quest√£o" },
          { num: 2, position: "Obst√°culos", meaning: "O que vai contra" },
          { num: 3, position: "Coroa", meaning: "Aspira√ß√µes ocultas" },
          { num: 4, position: "Raiz", meaning: "Influ√™ncia oculta" },
          { num: 5, position: "Passado Pr√≥ximo", meaning: "Contexto recente" },
          {
            num: 6,
            position: "Futuro Pr√≥ximo",
            meaning: "Desenvolvimento esperado",
          },
          { num: 7, position: "Atitude", meaning: "Sua posi√ß√£o" },
          { num: 8, position: "Ambiente", meaning: "Influ√™ncias externas" },
          { num: 9, position: "Esperan√ßa/Medo", meaning: "O que move voc√™" },
          { num: 10, position: "Resultado", meaning: "Desfecho prov√°vel" },
        ],
        love: [
          { position: "Voc√™", meaning: "Como voc√™ se sente" },
          { position: "Parceiro", meaning: "Como o outro se sente" },
          { position: "Futuro", meaning: "Tend√™ncia da rela√ß√£o" },
        ],
        five: [
          { position: "Tema", meaning: "O que est√° em jogo" },
          { position: "Desafio", meaning: "O principal obst√°culo" },
          { position: "Conselho", meaning: "A melhor atitude" },
          { position: "Ambiente", meaning: "Influ√™ncias externas" },
          { position: "Resultado", meaning: "Tend√™ncia / desfecho" },
        ],
        horseshoe: [
          { position: "Passado", meaning: "A origem da situa√ß√£o" },
          { position: "Presente", meaning: "O cen√°rio atual" },
          { position: "Influ√™ncia Oculta", meaning: "O que est√° por tr√°s" },
          { position: "Obst√°culos", meaning: "O que desafia" },
          { position: "Ambiente", meaning: "For√ßas ao redor" },
          { position: "A√ß√£o", meaning: "O que fazer" },
          { position: "Resultado", meaning: "Tend√™ncia" },
        ],
      };

      function getTodayKey() {
        const d = new Date();
        const yyyy = d.getFullYear();
        const mm = String(d.getMonth() + 1).padStart(2, "0");
        const dd = String(d.getDate()).padStart(2, "0");
        return `${yyyy}-${mm}-${dd}`;
      }

      function drawFromDeck(count, randomFn) {
        const deck = [...DECK];
        shuffle(deck, randomFn);
        const drawn = deck.slice(0, count).map((card) => ({
          cardId: card.id,
          reversed: randomFn() > 0.5,
        }));
        return drawn;
      }

      function formatCard(card, reversed = false) {
        const orientation = reversed ? "(Invertida)" : "(Direita)";
        const meaning = reversed
          ? card.meanings.reversed
          : card.meanings.upright;

        const badge =
          card.arcana === "major"
            ? `Arcano Maior ${card.number}`
            : `Arcano Menor ‚Ä¢ ${card.suitPt}`;

        const extra =
          card.arcana === "major"
            ? `Elemento: ${card.element}`
            : `Elemento: ${card.element}`;

        return `
          <img
            src="${card.image}"
            alt="${card.name}"
            class="card-image"
            onerror="this.src='https://via.placeholder.com/300x450?text=${encodeURIComponent(
              card.name
            )}'"
          >
          <div class="card-info">
            <div class="card-number">${badge}</div>
            <div class="card-name">${card.name}</div>
            <div class="card-element">${extra}</div>
            <div class="card-orientation">${orientation}</div>
          </div>
          <div class="meanings-grid">
            <div class="meaning-box">
              <div class="meaning-label">üìñ Significado</div>
              <div class="meaning-text">${meaning}</div>
            </div>
            <div class="meaning-box">
              <div class="meaning-label">üí° Interpreta√ß√£o</div>
              <div class="meaning-text">${card.interpretation}</div>
            </div>
            <div class="meaning-box">
              <div class="meaning-label">üîë Palavras‚Äëchave</div>
              <div class="meaning-text">${card.keywords.join(" ‚Ä¢ ")}</div>
            </div>
          </div>
        `;
      }

      function switchReading(type, btn) {
        // Keep history visible; only toggle reading sections.
        document
          .querySelectorAll('[id$="-section"]:not(#history-section)')
          .forEach((el) => el.classList.add("hidden"));
        document.getElementById(type + "-section").classList.remove("hidden");

        const buttons = document.querySelectorAll(".reading-btn");
        buttons.forEach((b) => b.classList.remove("active"));
        const activeBtn =
          btn || document.querySelector(`.reading-btn[data-reading="${type}"]`);
        activeBtn?.classList.add("active");
      }

      function saveReading(type, drawn, meta = {}) {
        const now = new Date();
        const entry = {
          id: `${now.getTime()}-${Math.random().toString(16).slice(2)}`,
          createdAt: now.toISOString(),
          type,
          drawn,
          meta,
        };

        let current = loadHistory();
        if (type === "daily" && meta.day) {
          current = current.filter(
            (h) => !(h.type === "daily" && h.meta && h.meta.day === meta.day)
          );
        }

        current.unshift(entry);
        const capped = current.slice(0, 20);
        localStorage.setItem(HISTORY_KEY, JSON.stringify(capped));
        renderHistory();
      }

      function loadHistory() {
        try {
          const raw = localStorage.getItem(HISTORY_KEY);
          const parsed = raw ? JSON.parse(raw) : [];
          return Array.isArray(parsed) ? parsed : [];
        } catch (e) {
          return [];
        }
      }

      function clearHistory() {
        localStorage.removeItem(HISTORY_KEY);
        renderHistory();
      }

      function typeLabel(type) {
        switch (type) {
          case "daily":
            return "Mensagem do Dia";
          case "three":
            return "3 Cartas";
          case "celtic":
            return "Cruz Celta";
          case "love":
            return "Relacionamento";
          case "five":
            return "5 Cartas";
          case "horseshoe":
            return "Ferradura";
          default:
            return type;
        }
      }

      function renderHistory() {
        const root = document.getElementById("history-content");
        if (!root) return;

        const history = loadHistory();
        if (history.length === 0) {
          root.innerHTML = `<div style="text-align:center;color:var(--color-text-light);padding:1rem;">Nenhuma leitura guardada ainda.</div>`;
          return;
        }

        root.innerHTML = history
          .map((h) => {
            const d = new Date(h.createdAt);
            const when = d.toLocaleString();
            return `
              <div class="history-item">
                <div class="history-meta">
                  <div class="history-title">${typeLabel(h.type)}</div>
                  <div class="history-subtitle">${when}</div>
                </div>
                <div class="history-actions">
                  <button class="btn btn-secondary" onclick="openHistory('${
                    h.id
                  }')">Abrir</button>
                </div>
              </div>
            `;
          })
          .join("");
      }

      function openHistory(id) {
        const history = loadHistory();
        const entry = history.find((h) => h.id === id);
        if (!entry) return;

        switchReading(entry.type);
        renderReading(entry.type, entry.drawn, { fromHistory: true });
      }

      function renderSpreadCards(containerId, positions, drawn) {
        const container = document.getElementById(containerId);
        if (!container) return;
        let html = "";
        for (let i = 0; i < positions.length; i++) {
          const p = positions[i];
          const draw = drawn[i];
          const card = CARD_BY_ID.get(draw.cardId);
          const reversed = draw.reversed;
          html += `
            <div class="spread-card">
              <div class="spread-position">${p.num ? `#${p.num} ` : ""}${
            p.position
          }</div>
              <div class="spread-position-meaning">${p.meaning}</div>
              <img
                src="${card.image}"
                alt="${card.name}"
                class="spread-card-image"
                onerror="this.src='https://via.placeholder.com/250x350?text=${encodeURIComponent(
                  card.name
                )}'"
              >
              <div class="spread-card-name">${card.name}</div>
              <div class="spread-orientation">${
                reversed ? "Invertida" : "Direita"
              }</div>
              <div style="font-size: 0.9rem; color: var(--color-text-light); margin-top: 0.75rem;">
                ${reversed ? card.meanings.reversed : card.meanings.upright}
              </div>
            </div>
          `;
        }
        container.innerHTML = html;
      }

      function renderCelticGrid(drawn) {
        const container = document.getElementById("celtic-content");
        if (!container) return;
        let html = "";
        for (let i = 0; i < spreads.celtic.length; i++) {
          const p = spreads.celtic[i];
          const draw = drawn[i];
          const card = CARD_BY_ID.get(draw.cardId);
          html += `
            <div class="celtic-card">
              <div class="celtic-position-num">${p.num}</div>
              <div class="celtic-position-title">${p.position}</div>
              <div class="celtic-meaning">${p.meaning}</div>
              <img
                src="${card.image}"
                alt="${card.name}"
                class="celtic-card-image"
                onerror="this.src='https://via.placeholder.com/200x280?text=${encodeURIComponent(
                  card.name
                )}'"
              >
              <div class="celtic-card-name">${card.name}</div>
              <div class="spread-orientation">${
                draw.reversed ? "Invertida" : "Direita"
              }</div>
            </div>
          `;
        }
        container.innerHTML = html;
      }

      function renderReading(type, drawn, meta = {}) {
        if (type === "daily") {
          const { cardId, reversed } = drawn[0];
          const card = CARD_BY_ID.get(cardId);
          document.getElementById("daily-content").innerHTML = formatCard(
            card,
            reversed
          );
          return;
        }

        if (type === "three") {
          renderSpreadCards("three-content", spreads.three, drawn);
          return;
        }

        if (type === "love") {
          renderSpreadCards("love-content", spreads.love, drawn);
          return;
        }

        if (type === "five") {
          renderSpreadCards("five-content", spreads.five, drawn);
          return;
        }

        if (type === "horseshoe") {
          renderSpreadCards("horseshoe-content", spreads.horseshoe, drawn);
          return;
        }

        if (type === "celtic") {
          renderCelticGrid(drawn);
        }
      }

      function drawDailyCard() {
        const seed = seedFromString(getTodayKey());
        const rng = mulberry32(seed);
        const drawn = drawFromDeck(1, rng);
        renderReading("daily", drawn);
        saveReading("daily", drawn, { day: getTodayKey() });
      }

      function drawThreeCards() {
        const drawn = drawFromDeck(3, Math.random);
        renderReading("three", drawn);
        saveReading("three", drawn);
      }

      function drawLoveReading() {
        const drawn = drawFromDeck(3, Math.random);
        renderReading("love", drawn);
        saveReading("love", drawn);
      }

      function drawFiveCardReading() {
        const drawn = drawFromDeck(5, Math.random);
        renderReading("five", drawn);
        saveReading("five", drawn);
      }

      function drawHorseshoeReading() {
        const drawn = drawFromDeck(7, Math.random);
        renderReading("horseshoe", drawn);
        saveReading("horseshoe", drawn);
      }

      function drawCelticCross() {
        const drawn = drawFromDeck(10, Math.random);
        renderReading("celtic", drawn);
        saveReading("celtic", drawn);
      }

      window.addEventListener("load", () => {
        renderHistory();
        drawDailyCard();
      });
    </script>
  </body>
</html>
